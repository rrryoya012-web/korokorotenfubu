# 開発ログ - 10.ころころてんふぶ

## 2026-02-05
- プロジェクト開始。
- 基本的なゲームロジックの実装（Matter.js、フルーツ生成、合体、ゲームオーバー判定など）。
- 画像アセットの実装（ランダム表情、スプライト表示）。

## 2026-02-06

### 初期実装
- 画像表示の改善とデバッグ機能追加。
- 箱のサイズ調整（スイカゲーム準拠）。
- BGMとSEの実装。
- 背景画像の実装と修正。
- 進化ルート表示欄の実装。

### サイズ調整
- アスペクト比を2:3に変更（400x600px → 333x500px）。
- 2層背景の実装（全体背景: bg2.png、箱背景: bg01.png）。

### タイトル画面・オプション・ハイスコアの実装
- **タイトル画面**:
    - `title1_start.png` を白背景で表示。
    - スタート・ハイスコア・オプションボタンを縦に配置。
    - 何かしらの操作（ボタンクリック）でゲーム画面へ遷移。
    
- **オプション画像 (タイトル用)**:
    - ポーズメニューと共通のデザイン（パステルピンク、角丸モーダル）を採用。
    - オーバーレイ表示に変更。
    - BGM/SE音量調整スライダー（0-100%）。
    
- **ハイスコア画面 (タイトル用)**:
    - ゲームオーバー画面と共通のデザイン（横長、左画像、右ランキング）を採用。
    - 左側には背景画像のサムネイルを表示。
    - 右側にはLocalStrageから読み込んだトップ3のスコアを表示。
    - オーバーレイ表示に変更。

### メニューUI刷新
- **ボタン配置変更**: 
    - 2行グリッドレイアウトに変更。
    - 上段: スタート、対戦、カスタマイズ（3ボタン）
    - 下段: ハイスコア、オプション（2ボタン）
- **新規ボタン追加**:
    - 対戦ボタン（機能は未実装、開発中メッセージ表示）
    - カスタマイズボタン

### カスタマイズ機能
- **カスタマイズ画面**:
    - タブ切り替えUI（進化順編集 / ボール一覧）
    - パステルピンクの可愛いデザイン
    - 保存・リセット・戻るボタン
- **進化順編集タブ**:
    - ドラッグ＆ドロップで進化順を入れ替え可能
    - 現在の11個のボールを円形アイコンで表示
    - 順番を示す番号バッジ付き
- **ボール一覧タブ**:
    - 全18種類のボールをグリッド表示
    - クリックで選択/解除
    - 選択中のボールはハイライト表示
    - 最低11個のボールを選択する必要あり
- **データ保存**:
    - LocalStorageに進化順を保存
    - 次回ゲーム開始時から反映

### ボールアセット
assets/ball/ 以下に18種類のキャラクターフォルダ:
- tsubumaru, yunagi, yuki, sirotsubaki, cyori, sarapi
- y, yuu, val, azya, senka (デフォルト11種)
- alice, ama, baniki, butti, chatora, potechi, urara (追加7種)

### UI改善
- **スコア表示**:
    - 「SCORE」ラベルを追加。
    - スコア数値を大きく表示（2.5rem）。
    - **背景色**: スカイブルー（rgba(135, 206, 235, 0.6)）、進化ルートと統一。
    - **位置調整**: `left: 80px` にさらに移動。
    
- **NEXTアイコン**:
    - プレビューサイズを60px → 80pxに拡大。
    - CSSで制御し、見やすく改善。
    
- **進化ルート（円形配列）**:
    - 2列配列から円形配列レイアウトに変更。
    - 260x260px の円形コンテナを右上に配置。
    - アイテムを円周上に12時の位置から時計回りに配置。
    - 各アイテム間に「▶」矢印を配置し、円周に沿って回転させることで進化の流れを表現。

### 画面遷移フロー（修正後）
1. **スプラッシュスクリーン**:
    - 白背景に `title1_start.png` を表示。
    - 画面クリックでタイトルメニューへ遷移。
    - **BGM再生開始**: クリック時に `startBGM()` を呼び出し。
2. **タイトルメニュー**:
    - メニューボタン（スタート、対戦、カスタマイズ、ハイスコア、オプション）を表示。
    - **背景画像**: 前面に `mainmenu.png` (contain)、奥に `mainmenu02.png` (cover) を設定して2層化。
    - タイトル文字は削除。
    - **各画面**: ボタンクリックでオーバーレイモーダルを表示。
3. **ゲーム画面**:
    - スタートボタンで遷移。
4. **設定メニュー（ポーズ画面）**:
    - ゲーム内右上に「歯車アイコン」を追加。
    - クリックでゲームが一時停止し、ポーズメニューが表示される。

### 設定メニュー（ポーズ画面）
- ゲーム内右上に「歯車アイコン」を追加。
- クリックでゲームが一時停止し、ポーズメニューが表示される。
- **クリック判定修正**: 
    - 歯車ボタン: `pointer-events: auto` と `cursor: pointer` を追加。
    - ポーズメニュー全体とボタン: `pointer-events: auto` を追加し、確実にクリックできるように修正。
- **機能**:
    - BGM/SE音量調整。
    - リトライ（リセット）ボタン。
    - 閉じるボタン（ゲーム再開）。

### デザイン刷新（かわいいUI）
- **ボタン**: パステルピンク（#FF9A9E）を基調とし、白枠と影をつけてポップなデザインに変更。
- **ポーズ/設定メニュー**: 薄いピンク背景、角丸コンテナ、Shadowを追加し、全体的に柔らかい印象に。
- **SCORE/NEXT位置**: 左端から80pxの位置に移動し、バランスを調整。

### ゲームオーバーシステム
- **判定ロジック**: 
    - 点線（ゲームオーバーライン）を超えた状態が続くとカウントダウン開始。
    - **カウントダウン演出**: 画面中央に大きく「3... 2... 1... BOOM!」と表示。
    - 0になると爆発演出（BOOM!表示）を経てゲームオーバー処理へ。
- **ランキングシステム**:
    - LocalStorageに上位3位までのスコアを保存。
    - ゲームオーバー時にランキングを更新・表示。
    - 数値として正しくソート・保存されるように修正。
- **ゲームオーバーUI**:
    - **横長レイアウト**: 480x360px (4:3) の固定サイズ。左側に今回のスコア、右側にランキングを表示。
    - **変更点**:
        - ゲームオーバー時もBGMを継続再生。
        - 左側のハイスコア表示を削除し、右側のランキングのみで自己ベストを表示するように変更。
        - 左寄せ配置で見やすく調整。

### v1.0 リリース前の最終調整
- **カスタマイズ機能の改善**:
    - **ドラッグ＆ドロップ**: デッキ内並べ替えと、プールからデッキへの入れ替えをD&Dで直感的に操作可能に。
    - **サイズ修正**: 画像再読み込み(preloadImages)を適切に呼び出すことで、デッキ変更後にボールサイズがおかしくなるバグを修正。
- **ハイスコア機能の強化**:
    - **メインメニュー**: 専用のハイスコア確認画面を追加。左にベストスコア、右にランキングを表示。
    - **ゲームオーバー画面**: 左に今回のスコア、右にランキングを表示するように統一。
    - **デザイン**: 黄色とオレンジを基調とした目立つデザインに変更。文字色も調整して視認性向上。
    - **堅牢性**: 不正なデータがLocalStorageにあっても自動復旧するロジックを追加。
- **UX改善**:
    - **ポーズメニュー**: 「メインメニューに戻る」ボタンを追加し、タイトル画面へ戻れるようにした。
    - **対戦機能**: 今回は次回アップデートへ延期し、ボタンのみ設置（開発中アラート）。
    - **ズーム調整ヒント**: ゲーム開始時に「Ctrl+±で画面サイズ調整」のヒントを表示(PC版のみ、初回限定)。
    - **（2026-02-06）表示修正**: 視認性を確保するため、強制表示モード（デバッグ）、z-indexの強化（最前面化）を実施。
- **リリース準備**:
    - タスクリストと実装計画書の更新。
    - GitHub公開用の最終コミット準備。
